sequenceDiagram
  participant CBTRN01C
  participant DALYTRANFILE
  participant CUSTFILE
  participant XREFFILE
  participant CARDFILE
  participant ACCTFILE
  participant TRANFILE

  activate CBTRN01C
  CBTRN01C->>+DALYTRANFILE: Open
  DALYTRANFILE-->>-CBTRN01C: Open Successful
  CBTRN01C->>+CUSTFILE: Open
  CUSTFILE-->>-CBTRN01C: Open Successful
  CBTRN01C->>+XREFFILE: Open
  XREFFILE-->>-CBTRN01C: Open Successful
  CBTRN01C->>+CARDFILE: Open
  CARDFILE-->>-CBTRN01C: Open Successful
  CBTRN01C->>+ACCTFILE: Open
  ACCTFILE-->>-CBTRN01C: Open Successful
  CBTRN01C->>+TRANFILE: Open
  TRANFILE->>CBTRN01C: Open Successful

  loop For Each Transaction in DALYTRANFILE
    CBTRN01C->>+DALYTRANFILE: Read Transaction
    DALYTRANFILE-->>-CBTRN01C: Transaction Data
    CBTRN01C->>+XREFFILE: Verify Card Number
    XREFFILE-->>-CBTRN01C: Card Verification Result
    alt Card is Valid
      CBTRN01C->>+ACCTFILE: Retrieve Account Details
      ACCTFILE-->>-CBTRN01C: Account Details
      CBTRN01C->>+TRANFILE: Prepare Transaction Update
      TRANFILE->>CBTRN01C: Update Prepared
    else Card is Invalid
      CBTRN01C->>CBTRN01C: Log Error (Invalid Card)
    end
  end

  CBTRN01C->>+DALYTRANFILE: Close
  DALYTRANFILE->>-CBTRN01C: Close Successful
  CBTRN01C->>+CUSTFILE: Close
  CUSTFILE->>-CBTRN01C: Close Successful
  CBTRN01C->>+XREFFILE: Close
  XREFFILE->>-CBTRN01C: Close Successful
  CBTRN01C->>+CARDFILE: Close
  CARDFILE->>-CBTRN01C: Close Successful
  CBTRN01C->>+ACCTFILE: Close
  ACCTFILE->>-CBTRN01C: Close Successful
  CBTRN01C->>+TRANFILE: Close
  TRANFILE->>-CBTRN01C: Close Successful
  deactivate CBTRN01C