
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>00009-CBTRN02C_cbl</title>
    <!-- Incluindo o Bootstrap CSS a partir de CDN -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- Incluindo o Highlight.js CSS para destaque de código -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/default.min.css">
    <style>
        body {
            padding: 20px;
        }
        img {
            max-width: 100%;
            height: auto;
        }
        /* Estilos personalizados podem ser adicionados aqui */
    </style>
</head>
<body>
    <div class="container">
        <p>Gerado em: 1º de outubro de 2024</p>
<h1><strong>Título do Documento:</strong> CardDemo - Especificação do Processador de Transações Diárias</h1>
<p><strong>Descrição Resumida:</strong>
O Processador de Transações Diárias CardDemo é um programa batch COBOL que processa transações diárias de cartão de crédito de um arquivo sequencial (<code>DALYTRAN-FILE</code>), valida-as em relação a dados de referência cruzada e de contas, atualiza saldos de transações e contas em arquivos indexados e grava transações rejeitadas em um arquivo separado (<code>DALYREJS-FILE</code>) com códigos de razão.</p>
<p><strong>Casos de Uso:</strong>
Como analista de dados, preciso garantir que apenas transações válidas sejam usadas para análise e relatórios. O sistema deve validar automaticamente cada transação e sinalizar quaisquer transações inválidas com os códigos de razão apropriados.</p>
<p><strong>Épico Relacionado:</strong>
<code>4</code> - <strong>Processamento de Transações</strong></p>
<p><strong>Requisitos Técnicos:</strong></p>
<ul>
<li><strong>Processamento de Arquivos:</strong>
<ul>
<li>Ler registros de transações sequencialmente de <code>DALYTRAN-FILE</code>.</li>
<li>Gravar registros de transações processados em <code>TRANSACT-FILE</code> com indexação por <code>FD-TRANS-ID</code>.</li>
<li>Gravar transações rejeitadas com códigos de razão em <code>DALYREJS-FILE</code> sequencialmente.</li>
<li>Acessar e atualizar aleatoriamente <code>ACCOUNT-FILE</code> indexado por <code>FD-ACCT-ID</code>.</li>
<li>Acessar e atualizar aleatoriamente <code>TCATBAL-FILE</code> indexado por <code>FD-TRAN-CAT-KEY</code>.</li>
</ul>
</li>
<li><strong>Validação de Transação:</strong>
<ul>
<li>Validar o número do cartão de crédito (<code>DALYTRAN-CARD-NUM</code>) em relação a <code>XREF-FILE</code>.</li>
<li>Verificar a existência e o status da conta usando <code>ACCOUNT-FILE</code>.</li>
<li>Verificar se há transações acima do limite com base em <code>ACCT-CREDIT-LIMIT</code>.</li>
<li>Validar a data da transação em relação à data de expiração do cartão (<code>ACCT-EXPIRAION-DATE</code>).</li>
</ul>
</li>
<li><strong>Lançamento da Transação:</strong>
<ul>
<li>Atualizar o saldo da conta (<code>ACCT-CURR-BAL</code>) em <code>ACCOUNT-FILE</code>.</li>
<li>Atualizar o saldo da categoria da transação (<code>TRAN-CAT-BAL</code>) em <code>TCATBAL-FILE</code>.</li>
<li>Gerar e aplicar a data e hora da transação (<code>TRAN-PROC-TS</code>) no formato <code>DB2-FORMAT-TS</code>.</li>
</ul>
</li>
<li><strong>Tratamento de Erros:</strong>
<ul>
<li>Capturar e registrar códigos de status de arquivo para todas as operações de arquivo.</li>
<li>Implementar tratamento de erro específico para números de cartão inválidos, contas inexistentes, transações acima do limite e cartões expirados.</li>
<li>Gravar transações rejeitadas em <code>DALYREJS-FILE</code> com códigos de razão detalhados.</li>
</ul>
</li>
<li><strong>Regras de Negócio:</strong>
<ul>
<li><strong>Verificação de Limite de Crédito:</strong>
<ul>
<li>Entrada: <code>ACCT-CURR-CYC-CREDIT</code>, <code>ACCT-CURR-CYC-DEBIT</code>, <code>DALYTRAN-AMT</code>, <code>ACCT-CREDIT-LIMIT</code></li>
<li>Cálculo: <code>(ACCT-CURR-CYC-CREDIT - ACCT-CURR-CYC-DEBIT + DALYTRAN-AMT) &lt;= ACCT-CREDIT-LIMIT</code></li>
<li>Saída: Aprovar ou rejeitar a transação</li>
</ul>
</li>
<li><strong>Verificação de Data de Expiração do Cartão:</strong>
<ul>
<li>Entrada: <code>ACCT-EXPIRAION-DATE</code>, <code>DALYTRAN-ORIG-TS</code></li>
<li>Cálculo: <code>ACCT-EXPIRAION-DATE &gt;= DALYTRAN-ORIG-TS(1:10)</code></li>
<li>Saída: Aprovar ou rejeitar a transação</li>
</ul>
</li>
</ul>
</li>
<li><strong>Transformação de Dados:</strong>
<ul>
<li><strong>Geração de Data e Hora:</strong>
<ul>
<li>Entrada: <code>CURRENT-DATE</code></li>
<li>Transformação: Formatar data como <code>YYYY-MM-DD-HH.MI.SS.MS0000</code></li>
<li>Saída: <code>DB2-FORMAT-TS</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>Modelos Relacionados:</strong></p>
<ul>
<li><strong>Transação:</strong>
<ul>
<li><code>DALYTRAN-ID</code> (String): Identificador exclusivo para cada transação diária.</li>
<li><code>DALYTRAN-TYPE-CD</code> (String): Código que indica o tipo de transação (por exemplo, compra, pagamento).</li>
<li><code>DALYTRAN-CAT-CD</code> (String): Código que categoriza a transação (por exemplo, mantimentos, combustível, entretenimento).</li>
<li><code>DALYTRAN-SOURCE</code> (String): Origem da transação (por exemplo, online, terminal POS).</li>
<li><code>DALYTRAN-DESC</code> (String): Descrição da transação.</li>
<li><code>DALYTRAN-AMT</code> (Decimal): Valor da transação.</li>
<li><code>DALYTRAN-MERCHANT-ID</code> (String): Identificador exclusivo para o comerciante envolvido na transação.</li>
<li><code>DALYTRAN-MERCHANT-NAME</code> (String): Nome do comerciante.</li>
<li><code>DALYTRAN-MERCHANT-CITY</code> (String): Cidade do comerciante.</li>
<li><code>DALYTRAN-MERCHANT-ZIP</code> (String): CEP do comerciante.</li>
<li><code>DALYTRAN-CARD-NUM</code> (String): Número do cartão de crédito usado para a transação.</li>
<li><code>DALYTRAN-ORIG-TS</code> (String): Data e hora em que a transação foi iniciada.</li>
<li><code>TRAN-PROC-TS</code> (String): Data e hora em que a transação foi processada.</li>
</ul>
</li>
<li><strong>Referência Cruzada:</strong>
<ul>
<li><code>FD-XREF-CARD-NUM</code> (String): Número do cartão de crédito</li>
<li><code>FD-XREF-DATA</code> (String): Dados adicionais do cartão</li>
</ul>
</li>
<li><strong>Conta:</strong>
<ul>
<li><code>FD-ACCT-ID</code> (Numérico): Identificador exclusivo da conta</li>
<li><code>FD-ACCT-DATA</code> (String): Outras informações relacionadas à conta</li>
<li><code>ACCT-CURR-BAL</code> (Decimal): Saldo atual da conta.</li>
<li><code>ACCT-CURR-CYC-CREDIT</code> (Decimal): Total de créditos no ciclo atual.</li>
<li><code>ACCT-CURR-CYC-DEBIT</code> (Decimal): Total de débitos no ciclo atual.</li>
<li><code>ACCT-CREDIT-LIMIT</code> (Decimal): Limite de crédito da conta.</li>
<li><code>ACCT-EXPIRATION-DATE</code> (String): Data de expiração do cartão de crédito.</li>
</ul>
</li>
<li><strong>Saldo da Categoria de Transação:</strong>
<ul>
<li><code>FD-TRAN-CAT-KEY</code> (String): Chave composta para o registro de saldo da categoria de transação (inclui ID da conta, código do tipo de transação e código da categoria).</li>
<li><code>FD-TRANCAT-ACCT-ID</code> (Numérico): Identificador da conta</li>
<li><code>FD-TRANCAT-TYPE-CD</code> (String): Código do tipo de transação</li>
<li><code>FD-TRANCAT-CD</code> (Numérico): Código da categoria da transação</li>
<li><code>FD-FD-TRAN-CAT-DATA</code> (String): Outros dados de saldo da categoria de transação</li>
<li><code>TRAN-CAT-BAL</code> (Decimal): Saldo para uma categoria de transação específica.</li>
</ul>
</li>
</ul>
<p><strong>Configurações:</strong></p>
<ul>
<li><code>DALYTRAN-FILE</code>: Caminho para o arquivo de entrada de transações diárias.</li>
<li><code>TRANSACT-FILE</code>: Caminho para o arquivo de saída de transações.</li>
<li><code>XREF-FILE</code>: Caminho para o arquivo de entrada de referência cruzada.</li>
<li><code>DALYREJS-FILE</code>: Caminho para o arquivo de saída de rejeições diárias.</li>
<li><code>ACCOUNT-FILE</code>: Caminho para o arquivo mestre da conta.</li>
<li><code>TCATBAL-FILE</code>: Caminho para o arquivo de saldo da categoria de transação.</li>
</ul>
<p><strong>Melhorias de Código:</strong></p>
<ul>
<li><strong>Tratamento de Erros:</strong> Implementar uma rotina de tratamento de erros mais centralizada para reduzir a duplicação de código e melhorar a manutenção.</li>
<li><strong>Registro em Log:</strong> Aprimorar o registro em log para incluir data e hora, versão do programa e detalhes específicos para cada erro ou rejeição.</li>
<li><strong>Modularidade:</strong> Dividir o programa em módulos menores e mais gerenciáveis ​​para melhor organização e legibilidade.</li>
<li><strong>Estruturas de Dados:</strong> Utilizar estruturas de dados mais descritivas para melhorar a clareza do código.</li>
<li><strong>Comentários:</strong> Adicionar mais comentários em linha para explicar a lógica por trás de seções específicas do código.</li>
</ul>
<p><strong>Melhorias de Segurança:</strong></p>
<ul>
<li><strong>Acesso a Arquivos:</strong> Implementar controles de acesso a arquivos mais rígidos para evitar acesso não autorizado a dados confidenciais.</li>
<li><strong>Criptografia de Dados:</strong> Considerar a criptografia de dados confidenciais em repouso e em trânsito.</li>
<li><strong>Trilha de Auditoria:</strong> Aprimorar a trilha de auditoria registrando todas as operações de arquivo, incluindo IDs de usuário e data e hora.</li>
</ul>
<p><strong>Diagrama Conceitual:</strong></p>
<img src="00009-CBTRN02C_cbl_diagram_1.svg" alt="Mermaid Diagram 1" style="max-width: 100%; height: auto;"><p>–Made by “Smart Engineering” (by Compass.UOL)–</p>

    </div>
    <!-- Incluindo o jQuery e o Bootstrap JS a partir de CDN -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Incluindo o Highlight.js JS para destaque de código -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
</body>
</html>
