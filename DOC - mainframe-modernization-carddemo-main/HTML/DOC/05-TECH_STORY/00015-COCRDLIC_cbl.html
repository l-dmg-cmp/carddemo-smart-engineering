
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>00015-COCRDLIC_cbl</title>
    <!-- Incluindo o Bootstrap CSS a partir de CDN -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- Incluindo o Highlight.js CSS para destaque de código -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/default.min.css">
    <style>
        body {
            padding: 20px;
        }
        img {
            max-width: 100%;
            height: auto;
        }
        /* Estilos personalizados podem ser adicionados aqui */
    </style>
</head>
<body>
    <div class="container">
        <p>Gerado em: 1º de outubro de 2024</p>
<p><strong>Título do Documento:</strong> Especificação de Exibição e Navegação da Lista de Cartões de Crédito</p>
<p><strong>Descrição Resumida:</strong> Esta especificação detalha a funcionalidade para exibir e navegar em uma lista de cartões de crédito dentro de um Sistema de Gerenciamento de Cartão de Crédito. Este módulo atende tanto usuários administrativos que podem visualizar todos os registros quanto usuários regulares que podem visualizar apenas cartões associados às suas contas.</p>
<p><strong>Histórias do Usuário:</strong>
Como Analista de Dados, preciso visualizar uma lista de cartões de crédito para acessar e analisar dados do cartão de crédito.</p>
<p><strong>Épico Relacionado:</strong>
3 - Gerenciamento de Cartão de Crédito</p>
<p><strong>Requisitos Técnicos:</strong></p>
<ul>
<li>
<p><strong>Exibir Lista de Cartões de Crédito:</strong> Este método recupera e exibe uma lista de cartões de crédito com base na função do usuário e nos filtros aplicados.</p>
<ul>
<li>Entrada:
<ul>
<li>Função do Usuário (<code>CDEMO-USRTYP-USER</code>: Tipo de usuário - Usuário (não administrador) ou Administrador) de <code>CARDDEMO-COMMAREA</code>.</li>
<li>ID da Conta (<code>CDEMO-ACCT-ID</code>: Número da conta para filtragem) de <code>CARDDEMO-COMMAREA</code>.</li>
<li>Número do Cartão (<code>CDEMO-CARD-NUM</code>: Número do cartão para filtragem) de <code>CARDDEMO-COMMAREA</code>.</li>
<li>Detalhes de paginação: (<code>WS-CA-SCREEN-NUM</code>: Número da página atual) de <code>WS-THIS-PROGCOMMAREA</code>.</li>
<li>Solicitações de navegação (teclas PF7/F8) da entrada do usuário.</li>
</ul>
</li>
<li>Processamento:
<ul>
<li>Se o usuário for um administrador (<code>CDEMO-USRTYP-USER</code> for verdadeiro), recupere todos os registros de cartão de crédito.</li>
<li>Se o usuário não for um administrador, recupere os registros de cartão de crédito associados ao <code>CDEMO-ACCT-ID</code> fornecido em <code>CARDDEMO-COMMAREA</code>.</li>
<li>Aplique a filtragem com base em <code>CDEMO-ACCT-ID</code> e <code>CDEMO-CARD-NUM</code> se fornecido.</li>
<li>Recupere e exiba no máximo <code>WS-MAX-SCREEN-LINES</code> (o valor padrão é <code>7</code>) registros por página.</li>
<li>Lide com a paginação com base em <code>WS-CA-SCREEN-NUM</code> e solicitações de navegação do usuário (teclas PF7/F8).</li>
</ul>
</li>
<li>Saída:
<ul>
<li>Uma lista paginada de cartões de crédito exibida na tela <code>COCRDLIC</code>, mostrando o Número da Conta, o Número do Cartão e o Status do Cartão.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Filtrar Registros de Cartão de Crédito:</strong> Este método filtra registros de cartão de crédito com base em filtros de número de conta e cartão.</p>
<ul>
<li>Entrada:
<ul>
<li><code>CARD-RECORD</code>: Registro do Cartão de Crédito recuperado do arquivo <code>CARDDAT</code>.</li>
<li><code>CC-ACCT-ID</code>: Valor do filtro de ID da conta da entrada do usuário.</li>
<li><code>CC-CARD-NUM-N</code>: Valor do filtro de Número do Cartão da entrada do usuário.</li>
<li><code>FLG-ACCTFILTER-ISVALID</code>: Sinalizador indicando se o filtro de ID da conta é válido.</li>
<li><code>FLG-CARDFILTER-ISVALID</code>: Sinalizador indicando se o filtro de Número do Cartão é válido.</li>
</ul>
</li>
<li>Processamento:
<ul>
<li>Se <code>FLG-ACCTFILTER-ISVALID</code> for verdadeiro, verifique se <code>CARD-ACCT-ID</code> corresponde a <code>CC-ACCT-ID</code>. Caso contrário, exclua o registro.</li>
<li>Se <code>FLG-CARDFILTER-ISVALID</code> for verdadeiro, verifique se <code>CARD-NUM</code> corresponde a <code>CC-CARD-NUM-N</code>. Caso contrário, exclua o registro.</li>
</ul>
</li>
<li>Saída:
<ul>
<li>O sinalizador <code>WS-DONOT-EXCLUDE-THIS-RECORD</code> é definido como verdadeiro se o registro deve ser incluído, caso contrário, <code>WS-EXCLUDE-THIS-RECORD</code> é definido como verdadeiro.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Navegar na Lista de Cartões de Crédito:</strong> Este método lida com solicitações do usuário para navegar até a próxima página ou página anterior de registros de cartão de crédito.</p>
<ul>
<li>Entrada:
<ul>
<li>Entrada do usuário (PF7 para a página anterior, PF8 para a próxima página).</li>
<li><code>WS-CA-SCREEN-NUM</code>: Número da página atual.</li>
<li><code>WS-CA-FIRST-CARD-NUM</code>: Número do Cartão do primeiro registro na página atual.</li>
<li><code>WS-CA-LAST-CARD-NUM</code>: Número do Cartão do último registro na página atual.</li>
<li><code>WS-CA-FIRST-CARD-ACCT-ID</code>: ID da conta do primeiro registro na página atual.</li>
<li><code>WS-CA-LAST-CARD-ACCT-ID</code>: ID da conta do último registro na página atual.</li>
</ul>
</li>
<li>Processamento:
<ul>
<li>Se PF7 for pressionado e não for a primeira página, decremente <code>WS-CA-SCREEN-NUM</code> e recupere a página anterior de registros.</li>
<li>Se PF8 for pressionado e houver mais páginas, incremente <code>WS-CA-SCREEN-NUM</code> e recupere a próxima página de registros.</li>
<li>Atualize a chave inicial para a recuperação da próxima/anterior página com base em <code>WS-CA-FIRST-CARD-NUM</code>, <code>WS-CA-LAST-CARD-NUM</code>, <code>WS-CA-FIRST-CARD-ACCT-ID</code> e <code>WS-CA-LAST-CARD-ACCT-ID</code>.</li>
</ul>
</li>
<li>Saída:
<ul>
<li>Atualizações para <code>WS-CA-SCREEN-NUM</code>, <code>WS-CA-FIRST-CARD-NUM</code>, <code>WS-CA-LAST-CARD-NUM</code>, <code>WS-CA-FIRST-CARD-ACCT-ID</code> e <code>WS-CA-LAST-CARD-ACCT-ID</code> para gerenciar a paginação.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Selecionar Cartão de Crédito para Detalhes/Atualização:</strong> Este método lida com a seleção do usuário de um cartão de crédito da lista para visualizar detalhes ou realizar atualizações.</p>
<ul>
<li>Entrada: Entrada do usuário (caractere ‘S’ para visualização detalhada, ‘U’ para atualização) nos campos <code>CRDSEL</code> na tela.</li>
<li>Processamento:
<ul>
<li>Valida a entrada do usuário para garantir que apenas um único registro seja selecionado para visualização ou atualização.</li>
<li>Identifica o registro selecionado com base no número da linha e código de ação (‘S’ ou ‘U’).</li>
<li>Define sinalizadores apropriados (<code>VIEW-REQUESTED-ON</code> ou <code>UPDATE-REQUESTED-ON</code>) para indicar a ação solicitada.</li>
</ul>
</li>
<li>Saída:
<ul>
<li>Atualizações para <code>CDEMO-ACCT-ID</code> e <code>CDEMO-CARD-NUM</code> em <code>CARDDEMO-COMMAREA</code> com os detalhes do cartão selecionado.</li>
<li>Transferência de controle para o programa <code>COCRDSLC</code> (Visualização de Detalhes do Cartão) ou <code>COCRDUPC</code> (Atualização do Cartão) com base na ação selecionada.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>Modelos Relacionados:</strong></p>
<ul>
<li>
<p><strong><code>CARDDEMO-COMMAREA</code>:</strong> Estrutura de dados compartilhada para comunicação entre programas.</p>
<ul>
<li><code>CDEMO-USRTYP-USER</code> (<code>Boolean</code>):  Indica se o usuário é um usuário regular. Verdadeiro para usuários regulares, falso para administradores.</li>
<li><code>CDEMO-ACCT-ID</code> (<code>Integer</code>): ID da conta para filtrar cartões de crédito (aplicável apenas para usuários regulares).</li>
<li><code>CDEMO-CARD-NUM</code> (<code>String</code>): Número do Cartão de Crédito para filtragem.</li>
<li><code>CDEMO-FROM-PROGRAM</code> (<code>String</code>): Nome do programa de chamada.</li>
<li><code>CDEMO-FROM-TRANID</code> (<code>String</code>): ID da transação do programa de chamada.</li>
<li><code>CDEMO-LAST-MAP</code> (<code>String</code>):  Nome do último mapa acessado (tela).</li>
<li><code>CDEMO-LAST-MAPSET</code> (<code>String</code>): Nome do conjunto de mapas que contém o último mapa acessado.</li>
</ul>
</li>
<li>
<p><strong><code>WS-THIS-PROGCOMMAREA</code>:</strong>  Estrutura de dados para preservar o contexto específico do programa entre as chamadas.</p>
<ul>
<li><code>WS-CA-SCREEN-NUM</code> (<code>Integer</code>): Número da página atual para exibir registros de cartão de crédito.</li>
<li><code>WS-CA-LAST-PAGE-DISPLAYED</code> (<code>Integer</code>):  Indica se a última página de registros foi exibida.</li>
<li><code>WS-CA-NEXT-PAGE-IND</code> (<code>Character</code>):  Indica se existe uma próxima página de registros.</li>
<li><code>WS-CA-LAST-CARD-NUM</code> (<code>String</code>): Número do Cartão de Crédito do último registro exibido na página anterior.</li>
<li><code>WS-CA-LAST-CARD-ACCT-ID</code> (<code>Integer</code>): ID da conta do último registro exibido na página anterior.</li>
<li><code>WS-CA-FIRST-CARD-NUM</code> (<code>String</code>): Número do Cartão de Crédito do primeiro registro exibido na página atual.</li>
<li><code>WS-CA-FIRST-CARD-ACCT-ID</code> (<code>Integer</code>): ID da conta do primeiro registro exibido na página atual.</li>
</ul>
</li>
<li>
<p><strong><code>CARD-RECORD</code>:</strong> Estrutura de dados que representa um registro de cartão de crédito.</p>
<ul>
<li><code>CARD-NUM</code> (<code>String</code>):  O número do cartão de crédito.</li>
<li><code>CARD-ACCT-ID</code> (<code>Integer</code>): O número da conta associado ao cartão de crédito.</li>
<li><code>CARD-ACTIVE-STATUS</code> (<code>String</code>):  O status do cartão de crédito.</li>
</ul>
</li>
</ul>
<p><strong>Configurações:</strong></p>
<ul>
<li><code>WS-MAX-SCREEN-LINES</code>:  Número máximo de registros de cartão de crédito a serem exibidos por página. O valor padrão é <code>7</code>.</li>
<li>Caminho do arquivo para <code>CARDDAT</code>:  Caminho para o arquivo VSAM contendo dados do cartão de crédito.</li>
<li>Caminho do arquivo para <code>CARDAIX</code>: Caminho para o arquivo VSAM contendo o índice alternativo em <code>CARDDAT</code> para ID da conta.</li>
</ul>
<p><strong>Melhorias de Código:</strong></p>
<ul>
<li>Implementar um mecanismo de tratamento de erros mais robusto: em vez de apenas definir sinalizadores, registrar erros em um arquivo ou banco de dados para melhor rastreamento e depuração.</li>
<li>Adicionar comentários detalhados para esclarecer a lógica complexa e melhorar a manutenção do código.</li>
<li>Explorar o uso de instruções PERFORM THRU para melhor organização e legibilidade do código.</li>
<li>Parametrizar nomes de arquivo e caminhos para melhor gerenciamento de configuração.</li>
</ul>
<p><strong>Melhorias de Segurança:</strong></p>
<ul>
<li>Mascarar ou truncar dados confidenciais, como números de cartão de crédito, na tela para aumentar a segurança.</li>
<li>Implementar a higienização de entrada para evitar vulnerabilidades como injeção de SQL.</li>
<li>Registrar ações do usuário, especialmente operações confidenciais como visualizar ou atualizar detalhes do cartão de crédito, para fins de auditoria.</li>
</ul>
<p><strong>Diagrama Conceitual:</strong></p>
<img src="00015-COCRDLIC_cbl_diagram_1.svg" alt="Mermaid Diagram 1" style="max-width: 100%; height: auto;"><p>–Made by “Smart Engineering” (by Compass.UOL)–</p>

    </div>
    <!-- Incluindo o jQuery e o Bootstrap JS a partir de CDN -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Incluindo o Highlight.js JS para destaque de código -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
</body>
</html>
